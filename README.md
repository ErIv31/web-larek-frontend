# Проектная работа "Веб-ларек"
https://github.com/ErIv31/web-larek-frontend.git

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура приложения

Приложение **Web-ларёк** построен по паттерну **MVP (Model-View-Presenter)**, который представлен 3 слоями:
- Модель (Model) предоставляет данные для пользовательского интерфейса.
- Представление (View) реализует отображение данных (Модели).
- Презентер (Presenter) обеспечивает взаимодействие между Моделью и Представлением, например, извлекает данные из Модели и форматирует их для отображения в Представлении.   

## Данные и типы данных, используемые в приложении

Карточка

```js
interface ICard {
  id: string;
  description: string;
  image: string;  
  title: string;  
  category: string;
  price: number | null;
  index?: number;
}
```

Массив карточек

```js
interface ICardArray {
  items: ICard[];
} 
```

Тип данных карточки в корзине

```js
type TCardBasket = Pick<ICard, '_id' | 'title' | 'price'>;
```

Корзина

```js
interface IBasket {
  items: TCardBasket[];
  addToBasket(): void;
  removeFromBasket(): void;
  getCardBasket(): TCardBasket[];
  getCardBasketAmount(): number;
  getPrice(): number;
  checkCardInBasket(): void;
  clearBasket(): void;
}
```

Заказ

```js
interface IOrder {
  payment: string;
  address: string;
  email: string;
  phone: string;
}
```

Данные пользователя при выборе оплаты и адреса

```js
interface IOrderDataFirst {
  payment: string;
  address: string;
}
```

Данные пользователя при вводе почты и телефона

```js
interface IOrderDataSecond {
  email: string;
  phone: string;
}
```

Коллекция данных пользователя при оформлении заказа

```js
interface IOderData {    
    setOrderDataFirst(): void;
    validateOrderFirst(): void;
    clearOrderFirst(): void;
    setOrderDataSecond(): void;    
    validateOrderSecond(): void;    
    clearOrderSecond(): void;
    formErrors: FormErrors;
}
```

```js
interface IOrderResult {
  id: string;
  amount: number;
}
```

Типы данных ошибок

```js
type FormErrors = Partial<Record<keyof IOrder, string>>;
```

## Базовый код

### Класс Api
Здесь реализована базовая логика отправки запросов.
Методы:
- `GET` - выполняет GET запрос, необходим для получения данных с сервера.
- `POST` - выполняет POST запрос, необходим для отправки данных на сервер.

### Класс EventEmitter
Брокер событий, который позволяет подписываться на события, отправлять события.
Методы:
- `on` - этот метод, позволяет подписаться на событие;
- `off` - этот метод, позволяет отписаться от события;
- `emit` - этот метод принимает имя события, которое мы хотим всем транслировать, и данные, которые будут отправляться в момент этого события;
- `trigger` - этот метод генерирует событие с заданными параметрами.

### Класс Component
Класс представления (View), который обеспечивает базовый функционал для дочерних компонентов.
Методы:
- `toggleClass` — переключает класс;
- `setText` — устанавливает текстовое содержимое;
- `setDisabled` — сменяет статус блокировки;
- `setVisible` — показывает компонент;
- `setHidden` — скрывает компонент;
- `setImage` — устанавливает изображение с альтернативным текстом;
- `render` — возвращает корневой DOM-элемент.

### Класс Model
Базовая модель, чтобы можно было отличить ее от простых объектов с данными. 
Методы:
- `emitChanges` — сообщает всем, что модель поменялась.

### Слой данных (Model)
## Класс CardData
Класс CardData отвечает за хранение и логику работы с данными карточек.

Данные полей класса:
- `_items` - массив карточек
- `_preview` - id карточки, выбранной для просмотра в модальном окне;
- `events: IEvents` - экземпляр класса EventEmitter для определения событий при изменении данных.

Методы для взаимодействия с данными:
- `getCard` - возвращает карточку по id;
- `getCardArray` - получает массив карточек;
а так же сеттеры и геттеры для сохранения и получения данных из полей класса.

## Класс OrderData
Класс OrderData отвечает за хранение и логику работы с данными заказа.

Данные полей класса:
- `orderData` - способ оплаты, адрес пользователя, электронная почта пользователя,телефон пользователя;
- `events: IEvents` - экземпляр класса EventEmitter для определения событий при изменении данных.

Методы для взаимодействия с данными:
- `getOrderDataFirst` - принимает способ оплаты и адрес пользователя;
- `getOrderDataSecond` - принимает электронную почту пользователя и телефон пользователя;
- `setOrderFieldFirst` и `setOrderFieldSecond` - обновляет одно из полей и при успешной проверке данных отправляет событие 'order:ready';
- `validateOrderFirst` и `validateOrderSecond` - проверяет корректность заполненных данных;
а так же сеттеры и геттеры для сохранения и получения данных из полей класса.

## Класс BasketData
Класс BasketData отвечает за хранение и логику работы с данными корзины.

Данные полей класса:
- `_items` - список товаров и общая стоимость товаров в корзине;
- `events: IEvents` - экземпляр класса EventEmitter для определения событий при изменении данных.

Методы для взаимодействия с данными:
- `addtoBasket` - добавить карточку в корзину, вызывает событие обновления корзины;
- `removeFromBasket` - удалить карточку из корзины, вызывает событие обновления корзины;
- `getCardBasket` - получить массив карточек в корзине, а именно id карточек;
- `getCardBasketAmount` - получить количество карточек в корзине;
- `getPrice` - получить итоговую стоимость;
- `checkCardInBasket` - проверить наличие карточки в корзине;
- `clearBasket` - очистить корзину;
а так же сеттеры и геттеры для сохранения и получения данных из полей класса.

### Слой представления (View)
## Класс Modal
Класс Modal реализует модальное окно. Открывается по клику на карточку. Закрывается по клику вне модального окна, по клику на крестик. 

Данные полей класса:
- `content: HTMLElement` - элемент модального окна;

Методы:
- `openModal` - открывает модальное окно;
- `closeModal` - закрывает модальное окно;
- `set content` - добовляет контент в модальное окно;
- `render` - обновляет состояние модального окна.

## Класс Form
Класс Form - это абстрактный класс и расширяет класс Component.

Данные полей класса:
- `_submit: HTMLButtonElement` - кнопка сабмита формы.
- `_errors: HTMLElement` - элемент для вывода ошибки;

Методы:
- `onInputChange` - отвечает за обработку изменений значения в поле формы;
- `render` - рендер содержимого формы;
- `set valid` - устанавливает состояние кнопки;
- `set errors` - устанавливает текст ошибки.

## Класс Page
Класс Page реализует главную страницу приложения.

Данные полей класса:
- `_catalog` - элемент отображения карточек товаров;
- `_basket` - элемент отображения корзины;
- `_counter` - элемент отображения количества товаров в корзине;
- `_wrapper` - элемент для блокировки страницы при открытии модального окна.

Методы:
- `set catalog` - сохраняет массив карточек;
- `set counter` - сохраняет количество товаров в корзине;
- `set locked` - блокирует страницу при открытии модального окна.

## Класс Card
Класс Card реализует компонент карточки.

Данные полей класса:
- `_title` - элемент содержащий заголовок карточки;
- `_price` - элемент содержащий стоимость товара;
- `_index` - элемент содержащий индекс товара для корзины;
- `_category` - элемент содержащий категорию товара;
- `_image` - элемент содержащий изображение карточки;
- `_description` - элемент содержащий описание товара;
- `_button` - элемент содержащий кнопку добавления товара в корзину или удаления товара из корзины.

Методы:
- `set title` - записывает название карточки; 
- `set price` - записывает стоимость товарв;
- `set index` - сохраняет индекс товара;
- `set category` - записывает категорию товара;
- `set image` - сохраняет изображение карточки;
- `set description` - записывает описание товара;

## Класс OrderFormPaymentAddress
Класс OrderFormPaymentAddress реализует форму для отображения адреса и способа оплаты.

Данные полей класса:
- `_buttonsPayment: HTMLButtonElement` - кнопка способа оплаты.

Методы:
- `set buttonsPayment` - добовляет выбранный способ оплаты и меняет статус кнопки на активный;
- `set address` - добавляет адрес доставки.

## Класс OrderFormEmailPhone
Класс OrderFormEmailPhone реализует форму для отображения электронный почты и телефона пользователя.

Методы:
- `set email` - добавляет значение почты пользователя;
- `set phone` - добавляет значение телефона пользователя.

## Класс Basket
Класс Basket реализует компонент корзины. Он отображает карточки, добавленные в корзину, общую стоимость и кнопку оформление заказа.

Данные полей класса:
- `_basketList` - список добавленных карточек в корзину;
- `_basketButton` - кнопка оформления заказа;
- `_total` - элемент с итоговой стоимостью заказа;

Методы:
- `set basketList` - добавляет количество карточек в корзине;
- `set items` - отображает список карточек в корзине;
- `set total` - отображает итоговую стоимость заказа.

## Класс Success
Класс Success реализует успешное оформление заказа.

Данные полей класса:
- `_total` - итоговая стоимость товаров;
-` _button` - кнопка закрытия модального окна.

Методы:
- `set total` - добавляет итоговую стоимость товаров.

### Слой коммуникации (Presenter)
## Класс AppApi
Класс AppApi принимает в конструктор экземпляр класса который реализует интерфейс IApi и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

Методы:
- `getCardApi` - получает id карточки;
- `getCardsArrayApi` - получает массив карточек;
- `postOrderCardsApi` - post-запрос отправки данных заказа и получения успешного ответа от сервера или ошибок.

### Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

## Список событий

События изменения данных:
- `card: select` - выбор карточки товара, которая откроется в модальном окне;
- `cardsList: change` - изменение каталога товаров, заполнение каталога на главной странице

События возникающие при взаимодействии пользователя с интерфейсом:
- `modal: open` - открытие модального окна;
- `modal: close` - закрытие модального окна;
- `basket: open` - открывается модальное окно с корзиной;
- `basket: add` - добавление товара в корзину;
- `basket: remove` - удаление товара из корзины;
- `orderPaymentAddress: open` - открывается модальное окно с выбором способа оплаты и адресом;
- `formPaymentAddress: submit` - подтверждение формы с выбором способа оплаты и адресом;
- `orderEmailPhone: open` - открывается модальное окно с контактной информацией пользователя;
- `formEmailPhone: submit` - отправка формы с контактной информацией пользователя.

## Пример взаимодействия слоя данных со слоем представления
Пользователь открывает корзину нажатием на иконку корзины. Срабатывает событие `basket: open`, отображаются данные корзины (данные получаем из класса `BasketData.items`), отображается итоговая стоимость товаров (данные получаем из класса `BasketData.getPrice()`).
